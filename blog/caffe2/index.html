<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Trying out Facebook’s Caffe2 – Asad Memon</title><meta name="description" content="Asad Memon&#x27;s homepage."/><meta property="og:title" content="Trying out Facebook’s Caffe2 – Asad Memon"/><meta property="og:type" content="article"/><meta property="og:url" content="https://asadmemon.comundefined"/><link rel="apple-touch-icon" href="/assets/favicon.png"/><link rel="shortcut icon" href="/assets/favicon.png"/><meta property="og:image" content="https://asadmemon.com/assets/img/main1.jpg"/><meta property="og:description" content="Asad Memon&#x27;s homepage."/><a href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,500" rel="stylesheet" type="text/css"></a><meta name="viewport" content="width=device-width, initial-scale=0.8"/><script>
// Head scripts for the site

// google analytics
(function (i, s, o, g, r, a, m) {
  i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
    (i[r].q = i[r].q || []).push(arguments)
  }, i[r].l = 1 * new Date(); a = s.createElement(o),
    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-58030862-1', 'auto');
  ga('send', 'pageview');

// heap analytics
window.heap = window.heap || [], heap.load = function (e, t) { window.heap.appid = e, window.heap.config = t = t || {}; var r = t.forceSSL || "https:" === document.location.protocol, a = document.createElement("script"); a.type = "text/javascript", a.async = !0, a.src = (r ? "https:" : "http:") + "//cdn.heapanalytics.com/js/heap-" + e + ".js"; var n = document.getElementsByTagName("script")[0]; n.parentNode.insertBefore(a, n); for (var o = function (e) { return function () { heap.push([e].concat(Array.prototype.slice.call(arguments, 0))) } }, p = ["addEventProperties", "addUserProperties", "clearEventProperties", "identify", "removeEventProperty", "setEventProperties", "track", "unsetEventProperty"], c = 0; c < p.length; c++)heap[p[c]] = o(p[c]) };
heap.load("1855799973");
</script><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/7475da46e5681ddd.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7475da46e5681ddd.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-597d285740f0a5b3.js" defer=""></script><script src="/_next/static/chunks/framework-0f8b31729833af61.js" defer=""></script><script src="/_next/static/chunks/main-fd67a91ddc57a058.js" defer=""></script><script src="/_next/static/chunks/pages/_app-95a924f6848c8568.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4d2f0a9f494a9dad.js" defer=""></script><script src="/_next/static/chunks/340-56639cdc358f7fa2.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-db05859b88c53380.js" defer=""></script><script src="/_next/static/_NHygLb8WWulxF4_4c9Q2/_buildManifest.js" defer=""></script><script src="/_next/static/_NHygLb8WWulxF4_4c9Q2/_ssgManifest.js" defer=""></script><script src="/_next/static/_NHygLb8WWulxF4_4c9Q2/_middlewareManifest.js" defer=""></script></head><body><div class="container"><h1 id="logo" class="text-center"><a href="/">Asad<b>Memon</b></a></h1><ul class="menu"><li><a href="/projects">All Projects</a></li><li><a href="/talks">Talks</a></li><li><a href="/blog">Blog</a></li><li><a target="_blank" href="https://asad.substack.com/">Newsletter</a></li><li><a target="_blank" href="https://github.com/asadm">Github</a></li><li><a target="_blank" href="https://www.linkedin.com/in/memonasad/">LinkedIn</a></li><li><a target="_blank" href="http://instagram.com/snapmemon">Instagram</a></li></ul><div id="__next"><div class="mt-4 blog"><h1>Trying out Facebook’s Caffe2</h1><div class="meta"><div class="subscribe-text"><a class="" href="/blog/">Back</a> | <a href="/feed.xml">Subscribe with RSS</a> or <a href="https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Fasadmemon.com%2Ffeed.xml">via Feedly</a>.</div><br/><span class="date" title="Sunday, July 9th 2017">5 years ago<!-- --> | <!-- -->3<!-- --> min read</span></div><p><img src="/assets/blog/old_posts/1__KK607b6rH65YWq2w__L5JcA.png"/></p><p>I was amazed by Facebook’s Realtime Style Transfer camera. Which were first seen in the popular Prisma app but that wasn’t realtime and only worked on photos.</p><p>Keep in mind that the original Prisma app sends the photo to their servers which then apply the selected filters. But the Facebook’s camera did it in realtime, <strong>on-device!</strong></p><p>They recently open-sourced <a href="https://caffe2.ai/">Caffe2</a>, a cross-platform framework behind some of their AI products. So I thought of trying it out. This is just my write-up on setting it up and trying the code samples.</p><h4>Installation</h4><p>I was setting it up on a Ubuntu instance, the <a href="https://caffe2.ai/docs/getting-started.html?platform=ubuntu&amp;configuration=compile">official installation instructions</a> mostly work fine. They are similar for macOS too. You can just follow those instructions till you have built and set up Caffe2. Some tips:</p><ol><li>Install dependancies.</li><li>Install these required python packages: <br/><code>sudo pip install numpy protobuf matplotlib future scikit-image</code></li><li>Skip CUDA setup instructions if you don’t have a CUDA GPU.</li><li>Clone Caffe2 repo and build.</li></ol><h4>Environment Variables</h4><p>Once you have built Caffe2. You need to set up environment variables:</p><pre><code>export PYTHONPATH=/usr/local:$PYTHONPATHexport PYTHONPATH=$PYTHONPATH:$PWD  
export LD\_LIBRARY\_PATH=/usr/local/lib:$LD\_LIBRARY\_PATH
</code></pre><p>Save them permanently, as these will reset if you reboot or re-login. <br/>
<!-- -->By appending the export commands in your <strong>.bashrc</strong> file. Here’s how:</p><pre><code>echo &#x27;export PYTHONPATH=/usr/local:$PYTHONPATH&#x27; &gt;&gt; ~/.bashrc  
echo &#x27;PYTHONPATH=$PYTHONPATH:$PWD&#x27; &gt;&gt; ~/.bashrc  
echo &#x27;export LD\_LIBRARY\_PATH=/usr/local/lib:$LD\_LIBRARY\_PATH&#x27; &gt;&gt; ~/.bashrc
</code></pre><h4>Jupyter Notebook</h4><p>As of right now, Caffe2 only supports Python 2.7.x and not 3. But the latest IPython 6.0 has dropped support for Python 2.x. So I had to install an earlier version. Here’s how you can do that:</p><pre><code>sudo pip install ipython==5.0  
sudo pip install jupyter
</code></pre><p>Let’s go to our home directory and start Jupyter Notebook on port 8889:</p><pre><code>cd ~/  
jupyter notebook --port=8889
</code></pre><p><strong>If you are running jupyter on your cloud instance (AWS, Azure, etc)</strong>:</p><p>You will have to forward that port to your local machine by creating a tunnel. Here’s how:</p><p>Open a new terminal <strong>on your local machine</strong> and run the following command:</p><pre><code>ssh -fNL 8889:localhost:8889 &lt;_SERVER-USERNAME_\&gt;@&lt;_SERVER-IP_\&gt;
</code></pre><p>Replace those placeholders with your own server details.</p><h4>Trying Samples</h4><ul><li>When you run Jupyter, it will print a URL, something like:</li></ul><p>http://localhost:8889/?token=e1d8c38df25456637d3c4cfd6</p><ul><li>Copy the link and open in your browser. You will get a folder view.</li><li>Head over to the folder: caffe2/python/tutorials.</li><li>Open the <strong>Basics.ipynb</strong> and try running the code (Shift+Enter to run the cell). If you don’t get any errors, you have configured Caffe2 and Jupyter!</li><li>If not, look for import errors, you might need to <em>pip install</em> some package.</li><li>You can ignore the GPU warnings if you didn’t set up CUDA:</li></ul><p><img src="/assets/blog/old_posts/1__bkRE30jJDB97yPac1J3sew.png"/></p><p><strong>Pro Tip:</strong> You can open a terminal to your server right from Jupyter Web UI. In the folder view, click New &gt;Terminal.</p><h4>Advanced Sample</h4><ul><li>Open <a href="http://localhost:8889/notebooks/caffe2/caffe2/python/tutorials/Loading_Pretrained_Models.ipynb"><strong>Loading<!-- -->_<!-- -->Pretrained<!-- -->_<!-- -->Models.ipynb</strong></a> and follow instructions. At the beginning it asks you to download the model.</li><li>You will need to fix the permissions of the download folder first:</li></ul><pre><code>sudo chmod 777 /usr/local/caffe2/python/models/
</code></pre><ul><li>Now you can download the model, like:</li></ul><pre><code>python -m caffe2.python.models.download -i squeezenet
</code></pre><ul><li>Return to the notebook and continue with instructions.</li></ul><h3>iOS and Android Samples</h3><p>Caffe2 is great because it can run on iOS and Android natively.</p><p>You can try the iOS example with a pre-trained model or adding your own. This sample is pretty straightforward and works: <a href="https://github.com/KleinYuan/Caffe2-iOS">https://github.com/KleinYuan/Caffe2-iOS</a></p><p>If you are too lazy to build and install, it’s available on iOS App Store too:<br/>
<a href="https://itunes.apple.com/ca/app/deep-learning-pro/id1239155582">https://itunes.apple.com/ca/app/deep-learning-pro/id1239155582</a></p><p>For Android, this sample should work:<br/>
<a href="https://github.com/bwasti/AICamera">https://github.com/bwasti/AICamera</a></p><p>I didn’t try this one as Android Studio is a mess to set up.</p></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"Trying out Facebook’s Caffe2","description":"I was amazed by Facebook’s Realtime Style Transfer camera. Which were first seen in the popular Prisma app but that wasn’t realtime and…","date":"2017-07-09T18:53:11.432Z","categories":[],"keywords":[]},"slug":"caffe2","mdxSource":{"compiledSource":"var d=Object.defineProperty,h=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var r=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;var l=(e,o,a)=\u003eo in e?d(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,t=(e,o)=\u003e{for(var a in o||(o={}))p.call(o,a)\u0026\u0026l(e,a,o[a]);if(r)for(var a of r(o))i.call(o,a)\u0026\u0026l(e,a,o[a]);return e},s=(e,o)=\u003eh(e,m(o));var u=(e,o)=\u003e{var a={};for(var n in e)p.call(e,n)\u0026\u0026o.indexOf(n)\u003c0\u0026\u0026(a[n]=e[n]);if(e!=null\u0026\u0026r)for(var n of r(e))o.indexOf(n)\u003c0\u0026\u0026i.call(e,n)\u0026\u0026(a[n]=e[n]);return a};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(a){var n=a,{components:e}=n,o=u(n,[\"components\"]);return mdx(MDXLayout,s(t(t({},layoutProps),o),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,mdx(\"img\",t({parentName:\"p\"},{src:\"/assets/blog/old_posts/1__KK607b6rH65YWq2w__L5JcA.png\",alt:null}))),mdx(\"p\",null,\"I was amazed by Facebook\\u2019s Realtime Style Transfer camera. Which were first seen in the popular Prisma app but that wasn\\u2019t realtime and only worked on photos.\"),mdx(\"p\",null,\"Keep in mind that the original Prisma app sends the photo to their servers which then apply the selected filters. But the Facebook\\u2019s camera did it in realtime, \",mdx(\"strong\",{parentName:\"p\"},\"on-device!\")),mdx(\"p\",null,\"They recently open-sourced \",mdx(\"a\",t({parentName:\"p\"},{href:\"https://caffe2.ai/\"}),\"Caffe2\"),\", a cross-platform framework behind some of their AI products. So I thought of trying it out. This is just my write-up on setting it up and trying the code samples.\"),mdx(\"h4\",null,\"Installation\"),mdx(\"p\",null,\"I was setting it up on a Ubuntu instance, the \",mdx(\"a\",t({parentName:\"p\"},{href:\"https://caffe2.ai/docs/getting-started.html?platform=ubuntu\u0026configuration=compile\"}),\"official installation instructions\"),\" mostly work fine. They are similar for macOS too. You can just follow those instructions till you have built and set up Caffe2. Some tips:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Install dependancies.\"),mdx(\"li\",{parentName:\"ol\"},\"Install these required python packages:\\xA0\",mdx(\"br\",{parentName:\"li\"}),mdx(\"inlineCode\",{parentName:\"li\"},\"sudo pip install numpy protobuf matplotlib future scikit-image\")),mdx(\"li\",{parentName:\"ol\"},\"Skip CUDA setup instructions if you don\\u2019t have a CUDA GPU.\"),mdx(\"li\",{parentName:\"ol\"},\"Clone Caffe2 repo and build.\")),mdx(\"h4\",null,\"Environment Variables\"),mdx(\"p\",null,\"Once you have built Caffe2. You need to set up environment variables:\"),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{}),`export PYTHONPATH=/usr/local:$PYTHONPATHexport PYTHONPATH=$PYTHONPATH:$PWD  \nexport LD\\\\_LIBRARY\\\\_PATH=/usr/local/lib:$LD\\\\_LIBRARY\\\\_PATH\n`)),mdx(\"p\",null,\"Save them permanently, as these will reset if you reboot or re-login.\\xA0\",mdx(\"br\",{parentName:\"p\"}),`\n`,\"By appending the export commands in your\\xA0\",mdx(\"strong\",{parentName:\"p\"},\".bashrc\"),\" file. Here\\u2019s how:\"),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{}),`echo 'export PYTHONPATH=/usr/local:$PYTHONPATH' \u003e\u003e ~/.bashrc  \necho 'PYTHONPATH=$PYTHONPATH:$PWD' \u003e\u003e ~/.bashrc  \necho 'export LD\\\\_LIBRARY\\\\_PATH=/usr/local/lib:$LD\\\\_LIBRARY\\\\_PATH' \u003e\u003e ~/.bashrc\n`)),mdx(\"h4\",null,\"Jupyter Notebook\"),mdx(\"p\",null,\"As of right now, Caffe2 only supports Python 2.7.x and not 3. But the latest IPython 6.0 has dropped support for Python 2.x. So I had to install an earlier version. Here\\u2019s how you can do that:\"),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{}),`sudo pip install ipython==5.0  \nsudo pip install jupyter\n`)),mdx(\"p\",null,\"Let\\u2019s go to our home directory and start Jupyter Notebook on port 8889:\"),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{}),`cd ~/  \njupyter notebook --port=8889\n`)),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"If you are running jupyter on your cloud instance (AWS, Azure, etc)\"),\":\"),mdx(\"p\",null,\"You will have to forward that port to your local machine by creating a tunnel. Here\\u2019s how:\"),mdx(\"p\",null,\"Open a new terminal \",mdx(\"strong\",{parentName:\"p\"},\"on your local machine\"),\" and run the following command:\"),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{}),`ssh -fNL 8889:localhost:8889 \u003c_SERVER-USERNAME_\\\\\u003e@\u003c_SERVER-IP_\\\\\u003e\n`)),mdx(\"p\",null,\"Replace those placeholders with your own server details.\"),mdx(\"h4\",null,\"Trying Samples\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"When you run Jupyter, it will print a URL, something like:\")),mdx(\"p\",null,\"http://localhost:8889/?token=e1d8c38df25456637d3c4cfd6\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Copy the link and open in your browser. You will get a folder view.\"),mdx(\"li\",{parentName:\"ul\"},\"Head over to the folder: caffe2/python/tutorials.\"),mdx(\"li\",{parentName:\"ul\"},\"Open the \",mdx(\"strong\",{parentName:\"li\"},\"Basics.ipynb\"),\" and try running the code (Shift+Enter to run the cell). If you don\\u2019t get any errors, you have configured Caffe2 and Jupyter!\"),mdx(\"li\",{parentName:\"ul\"},\"If not, look for import errors, you might need to \",mdx(\"em\",{parentName:\"li\"},\"pip install\"),\" some package.\"),mdx(\"li\",{parentName:\"ul\"},\"You can ignore the GPU warnings if you didn\\u2019t set up CUDA:\")),mdx(\"p\",null,mdx(\"img\",t({parentName:\"p\"},{src:\"/assets/blog/old_posts/1__bkRE30jJDB97yPac1J3sew.png\",alt:null}))),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Pro Tip:\"),\" You can open a terminal to your server right from Jupyter Web UI. In the folder view, click New \u003eTerminal.\"),mdx(\"h4\",null,\"Advanced Sample\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Open \",mdx(\"a\",t({parentName:\"li\"},{href:\"http://localhost:8889/notebooks/caffe2/caffe2/python/tutorials/Loading_Pretrained_Models.ipynb\"}),mdx(\"strong\",{parentName:\"a\"},\"Loading\",\"_\",\"Pretrained\",\"_\",\"Models.ipynb\")),\" and follow instructions. At the beginning it asks you to download the model.\"),mdx(\"li\",{parentName:\"ul\"},\"You will need to fix the permissions of the download folder first:\")),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{}),`sudo chmod 777 /usr/local/caffe2/python/models/\n`)),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Now you can download the model, like:\")),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{}),`python -m caffe2.python.models.download -i squeezenet\n`)),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Return to the notebook and continue with instructions.\")),mdx(\"h3\",null,\"iOS and Android\\xA0Samples\"),mdx(\"p\",null,\"Caffe2 is great because it can run on iOS and Android natively.\"),mdx(\"p\",null,\"You can try the iOS example with a pre-trained model or adding your own. This sample is pretty straightforward and works: \",mdx(\"a\",t({parentName:\"p\"},{href:\"https://github.com/KleinYuan/Caffe2-iOS\"}),\"https://github.com/KleinYuan/Caffe2-iOS\")),mdx(\"p\",null,\"If you are too lazy to build and install, it\\u2019s available on iOS App Store too:\",mdx(\"br\",{parentName:\"p\"}),`\n`,mdx(\"a\",t({parentName:\"p\"},{href:\"https://itunes.apple.com/ca/app/deep-learning-pro/id1239155582\"}),\"https://itunes.apple.com/ca/app/deep-learning-pro/id1239155582\")),mdx(\"p\",null,\"For Android, this sample should work:\",mdx(\"br\",{parentName:\"p\"}),`\n`,mdx(\"a\",t({parentName:\"p\"},{href:\"https://github.com/bwasti/AICamera\"}),\"https://github.com/bwasti/AICamera\")),mdx(\"p\",null,\"I didn\\u2019t try this one as Android Studio is a mess to set up.\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"readingTime":3},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"caffe2"},"buildId":"_NHygLb8WWulxF4_4c9Q2","isFallback":false,"gsp":true,"scriptLoader":[]}</script><div class="footer"><p>AsadMemon.com [<a href="https://github.com/asadm/asadm.github.io" target="_blank">source code</a>].</p></div></div></body></html>